<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent OS</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="nav">
            <div class="nav-brand" data-tooltip="Autonomous AI Agent Operating System" data-tooltip-position="bottom">
                <h1>Agent OS</h1>
            </div>
            <div class="nav-links">
                <button class="nav-link active" data-view="chat" data-tooltip="Converse with AI agents" data-tooltip-position="bottom">Chat</button>
                <button class="nav-link" data-view="images" data-tooltip="Generate images with AI" data-tooltip-position="bottom">Images</button>
                <button class="nav-link" data-view="agents" data-tooltip="Monitor and manage agents" data-tooltip-position="bottom">Agents</button>
                <button class="nav-link" data-view="constitution" data-tooltip="View and edit system rules" data-tooltip-position="bottom">Constitution</button>
                <button class="nav-link" data-view="memory" data-tooltip="Browse and manage memories" data-tooltip-position="bottom">Memory</button>
                <button class="nav-link" data-view="contracts" data-tooltip="Manage learning consent contracts" data-tooltip-position="bottom">Contracts</button>
                <button class="nav-link" data-view="system" data-tooltip="System status and settings" data-tooltip-position="bottom">System</button>
            </div>
            <div class="nav-status">
                <span id="connection-status" class="status-indicator disconnected" data-tooltip="WebSocket connection status" data-tooltip-position="bottom">Disconnected</span>
            </div>
            <div class="nav-user">
                <!-- Shows when not logged in -->
                <div id="auth-buttons" class="auth-buttons">
                    <button class="btn btn-secondary btn-small" onclick="app.showLoginModal()" data-tooltip="Sign in to your account" data-tooltip-position="bottom">Sign In</button>
                    <button class="btn btn-primary btn-small" onclick="app.showRegisterModal()" data-tooltip="Create a new account" data-tooltip-position="bottom">Sign Up</button>
                </div>
                <!-- Shows when logged in -->
                <div id="user-menu" class="user-menu" style="display: none;">
                    <button class="user-menu-btn" onclick="app.toggleUserDropdown()" data-tooltip="Account options" data-tooltip-position="bottom">
                        <span class="user-avatar" id="user-avatar">U</span>
                        <span class="user-name" id="user-display-name">User</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M7 10l5 5 5-5z"/></svg>
                    </button>
                    <div id="user-dropdown" class="user-dropdown">
                        <div class="dropdown-header">
                            <span class="dropdown-username" id="dropdown-username">username</span>
                            <span class="dropdown-role" id="dropdown-role">user</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item" onclick="app.showProfileModal()">
                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                            Profile
                        </button>
                        <button class="dropdown-item" onclick="app.showChangePasswordModal()">
                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>
                            Change Password
                        </button>
                        <button class="dropdown-item" onclick="app.showSessionsModal()">
                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"/></svg>
                            Sessions
                        </button>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item dropdown-item-danger" onclick="app.logout()">
                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
                            Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Chat View -->
            <section id="chat-view" class="view active">
                <div class="chat-container">
                    <div class="chat-sidebar">
                        <h3>Conversations</h3>
                        <button id="new-chat-btn" class="btn btn-primary" data-tooltip="Start a new conversation" data-tooltip-position="right">New Chat</button>
                        <div id="conversation-list" class="conversation-list"></div>
                    </div>
                    <div class="chat-main">
                        <div id="chat-messages" class="chat-messages">
                            <div class="welcome-message">
                                <h2>Welcome to Agent OS</h2>
                                <p>Start a conversation with your AI assistant.</p>
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <textarea id="chat-input" placeholder="Type your message..." rows="1" data-tooltip="Press Enter to send, Shift+Enter for new line"></textarea>
                            <button id="send-btn" class="btn btn-primary" data-tooltip="Send message (Enter)">Send</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Images View -->
            <section id="images-view" class="view">
                <div class="view-header">
                    <h2>Image Generation</h2>
                    <div class="view-actions">
                        <button id="refresh-images-btn" class="btn btn-secondary" data-tooltip="Refresh gallery">Refresh</button>
                    </div>
                </div>
                <div class="images-container">
                    <!-- Generation Panel -->
                    <div class="images-sidebar">
                        <h3>Generate Image</h3>
                        <form id="image-generation-form" class="generation-form">
                            <div class="form-group">
                                <label for="image-prompt">Prompt *</label>
                                <textarea id="image-prompt" placeholder="Describe the image you want to generate..." rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="image-negative-prompt">Negative Prompt</label>
                                <textarea id="image-negative-prompt" placeholder="What to avoid in the image..." rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="image-model">Model</label>
                                <select id="image-model">
                                    <option value="stable-diffusion-v1-5">Stable Diffusion v1.5</option>
                                    <option value="stable-diffusion-xl-base-1.0">SDXL Base 1.0</option>
                                    <option value="stable-diffusion-xl-turbo">SDXL Turbo</option>
                                    <option value="flux-1-schnell">FLUX.1 [schnell]</option>
                                    <option value="playground-v2.5">Playground v2.5</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="image-width">Width</label>
                                    <input type="number" id="image-width" value="512" min="64" max="2048" step="64">
                                </div>
                                <div class="form-group">
                                    <label for="image-height">Height</label>
                                    <input type="number" id="image-height" value="512" min="64" max="2048" step="64">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="image-steps">Steps</label>
                                    <input type="number" id="image-steps" value="20" min="1" max="150">
                                </div>
                                <div class="form-group">
                                    <label for="image-guidance">Guidance</label>
                                    <input type="number" id="image-guidance" value="7.5" min="1" max="30" step="0.5">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="image-seed">Seed (optional)</label>
                                <input type="number" id="image-seed" placeholder="Random">
                            </div>
                            <div class="form-group">
                                <label for="image-count">Number of Images</label>
                                <input type="number" id="image-count" value="1" min="1" max="4">
                            </div>
                            <button type="submit" class="btn btn-primary btn-full" id="generate-btn">
                                Generate Image
                            </button>
                        </form>
                        <div id="generation-progress" class="generation-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                            <span id="progress-text">Generating...</span>
                        </div>
                    </div>
                    <!-- Gallery -->
                    <div class="images-main">
                        <div class="stats-grid" id="images-stats"></div>
                        <h3>Gallery</h3>
                        <div id="images-gallery" class="images-gallery"></div>
                    </div>
                </div>
            </section>

            <!-- Agents View -->
            <section id="agents-view" class="view">
                <div class="view-header">
                    <h2>Agent Monitoring</h2>
                    <button id="refresh-agents-btn" class="btn btn-secondary" data-tooltip="Reload agent status">Refresh</button>
                </div>
                <div class="stats-grid" id="agents-stats"></div>
                <div class="agents-grid" id="agents-list"></div>
            </section>

            <!-- Constitution View -->
            <section id="constitution-view" class="view">
                <div class="view-header">
                    <h2>Constitutional Rules</h2>
                    <button id="add-rule-btn" class="btn btn-primary" data-tooltip="Create a new constitutional rule">Add Rule</button>
                </div>
                <div class="constitution-container">
                    <div class="rules-sidebar">
                        <h3>Sections</h3>
                        <div id="sections-list" class="sections-list"></div>
                    </div>
                    <div class="rules-main">
                        <div id="rules-list" class="rules-list"></div>
                    </div>
                </div>
            </section>

            <!-- Memory View -->
            <section id="memory-view" class="view">
                <div class="view-header">
                    <h2>Memory Management</h2>
                    <div class="view-actions">
                        <input type="text" id="memory-search" placeholder="Search memories..." class="search-input" data-tooltip="Filter memories by content or tags">
                        <button id="add-memory-btn" class="btn btn-primary" data-tooltip="Store a new memory entry">Add Memory</button>
                    </div>
                </div>
                <div class="stats-grid" id="memory-stats"></div>
                <div id="memory-list" class="memory-list"></div>
            </section>

            <!-- System View -->
            <section id="system-view" class="view">
                <div class="view-header">
                    <h2>System Status & Settings</h2>
                    <button id="refresh-system-btn" class="btn btn-secondary" data-tooltip="Reload system information">Refresh</button>
                </div>
                <div class="system-container">
                    <div class="system-panel">
                        <div class="system-info" id="system-info"></div>
                        <div class="system-health" id="system-health"></div>
                    </div>
                    <div class="system-panel">
                        <div class="settings-section">
                            <h3>Application Settings</h3>
                            <div class="settings-group">
                                <div class="setting-item-toggle">
                                    <div class="setting-info">
                                        <span class="setting-name">Debug Mode</span>
                                        <span class="setting-description">Show debug console with logs and diagnostics</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="setting-debug-mode" onchange="app.toggleDebugMode(this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item-toggle">
                                    <div class="setting-info">
                                        <span class="setting-name">Verbose Logging</span>
                                        <span class="setting-description">Include detailed request/response data in logs</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="setting-verbose-logging" onchange="app.updateSetting('verbose_logging', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item-toggle">
                                    <div class="setting-info">
                                        <span class="setting-name">Auto-Reconnect</span>
                                        <span class="setting-description">Automatically reconnect WebSocket on disconnect</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="setting-auto-reconnect" checked onchange="app.updateSetting('auto_reconnect', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item-toggle">
                                    <div class="setting-info">
                                        <span class="setting-name">Sound Notifications</span>
                                        <span class="setting-description">Play sound on new messages and alerts</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="setting-sound-notifications" onchange="app.updateSetting('sound_notifications', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item-toggle">
                                    <div class="setting-info">
                                        <span class="setting-name">Dark Theme</span>
                                        <span class="setting-description">Use dark color scheme (default)</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="setting-dark-theme" checked onchange="app.updateSetting('dark_theme', this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3>LLM Provider Settings</h3>
                            <div class="settings-group">
                                <div class="setting-item-input">
                                    <label for="setting-ollama-endpoint">Ollama Endpoint</label>
                                    <input type="text" id="setting-ollama-endpoint" value="http://localhost:11434" placeholder="http://localhost:11434">
                                </div>
                                <div class="setting-item-input">
                                    <label for="setting-llama-cpp-endpoint">Llama.cpp Endpoint</label>
                                    <input type="text" id="setting-llama-cpp-endpoint" value="http://localhost:8080" placeholder="http://localhost:8080">
                                </div>
                                <div class="setting-item-input">
                                    <label for="setting-default-model">Default Model</label>
                                    <input type="text" id="setting-default-model" value="llama3.2:3b" placeholder="llama3.2:3b">
                                </div>
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3>Server Settings</h3>
                            <div id="settings-list" class="settings-list"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Contracts View -->
            <section id="contracts-view" class="view">
                <div class="view-header">
                    <h2>Learning Contracts</h2>
                    <div class="view-actions">
                        <button id="create-contract-btn" class="btn btn-primary" data-tooltip="Create a new learning consent contract">New Contract</button>
                    </div>
                </div>
                <div class="contracts-container">
                    <!-- Templates Panel -->
                    <div class="contracts-sidebar">
                        <h3>Quick Templates</h3>
                        <div id="templates-list" class="templates-list"></div>
                    </div>
                    <!-- Active Contracts -->
                    <div class="contracts-main">
                        <div class="contracts-tabs">
                            <button class="contracts-tab active" data-status="active">Active</button>
                            <button class="contracts-tab" data-status="pending">Pending</button>
                            <button class="contracts-tab" data-status="expired">Expired</button>
                            <button class="contracts-tab" data-status="revoked">Revoked</button>
                        </div>
                        <div class="stats-grid" id="contracts-stats"></div>
                        <div id="contracts-list" class="contracts-list"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title"></h3>
                <button class="modal-close" data-tooltip="Close dialog (Esc)" data-tooltip-position="left">&times;</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer" id="modal-footer"></div>
        </div>
    </div>

    <!-- Debug Panel -->
    <div id="debug-panel" class="debug-panel" style="display: none;">
        <div class="debug-header">
            <h4>Debug Console</h4>
            <div class="debug-controls">
                <select id="debug-filter" onchange="app.filterDebugLogs(this.value)">
                    <option value="all">All</option>
                    <option value="info">Info</option>
                    <option value="warn">Warnings</option>
                    <option value="error">Errors</option>
                    <option value="network">Network</option>
                    <option value="websocket">WebSocket</option>
                </select>
                <button class="btn btn-small btn-secondary" onclick="app.clearDebugLogs()">Clear</button>
                <button class="btn btn-small btn-secondary" onclick="app.exportDebugLogs()">Export</button>
                <button class="debug-minimize" onclick="app.minimizeDebugPanel()">_</button>
                <button class="debug-close" onclick="app.toggleDebugMode(false)">&times;</button>
            </div>
        </div>
        <div class="debug-tabs">
            <button class="debug-tab active" data-tab="logs" onclick="app.switchDebugTab('logs')">Logs</button>
            <button class="debug-tab" data-tab="network" onclick="app.switchDebugTab('network')">Network</button>
            <button class="debug-tab" data-tab="state" onclick="app.switchDebugTab('state')">State</button>
            <button class="debug-tab" data-tab="performance" onclick="app.switchDebugTab('performance')">Performance</button>
        </div>
        <div class="debug-content">
            <div id="debug-logs" class="debug-tab-content active">
                <div id="debug-log-entries" class="debug-log-entries"></div>
            </div>
            <div id="debug-network" class="debug-tab-content">
                <div id="debug-network-entries" class="debug-network-entries"></div>
            </div>
            <div id="debug-state" class="debug-tab-content">
                <div id="debug-state-view" class="debug-state-view"></div>
            </div>
            <div id="debug-performance" class="debug-tab-content">
                <div id="debug-performance-view" class="debug-performance-view"></div>
            </div>
        </div>
        <div class="debug-resize-handle"></div>
    </div>

    <!-- Security utilities (must load before app.js) -->
    <script src="/static/js/crypto.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
